<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MuseAgent</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&family=Montserrat:wght@400;600&display=swap" rel="stylesheet" />
    <link rel="icon" href="/assets/ma-logo.png" />
    <link rel="manifest" href="./manifest.webmanifest" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <!-- Icons -->
    <div style="position:absolute; width:0; height:0; overflow:hidden">
      <?xml version="1.0" encoding="UTF-8"?>
    </div>
    <object type="image/svg+xml" data="./icons.svg" style="position:absolute; width:0; height:0; overflow:hidden"></object>
    <!-- Splash overlay -->
    <div id="splash" role="status" aria-live="polite">
      <div class="splash-content">
        <img id="splash-logo" class="splash-logo" src="/assets/ma-logo.png" alt="MuseAgent logo" />
        <div class="splash-title">MuseAgent</div>
        <div class="splash-subtitle muted">Music Intelligence — analyze • tag • recommend • report</div>
      </div>
    </div>

    <!-- App chrome -->
    <header class="app-header">
      <div class="brand">
        <img class="brand-logo" src="/assets/ma-logo.png" alt="MuseAgent" />
        <div class="brand-title">MuseAgent</div>
      </div>
      <nav class="app-nav" role="tablist" aria-label="Primary">
        <a href="#analyze" id="tab-analyze" class="tab" role="tab" aria-selected="true" aria-controls="panel-analyze">Analyze</a>
        <a href="#explore" id="tab-explore" class="tab" role="tab" aria-selected="false" aria-controls="panel-explore">Explore</a>
        <a href="#reports" id="tab-reports" class="tab" role="tab" aria-selected="false" aria-controls="panel-reports">Reports</a>
        <a href="#more" id="tab-more" class="tab hidden" role="tab" aria-selected="false" aria-controls="panel-more">More</a>
      </nav>
      <div class="header-actions">
        <label class="toggle">
          <input id="sound-toggle" type="checkbox" />
          <span class="slider"></span>
          <span class="label">Sound</span>
        </label>
        <label class="toggle">
          <input id="offline-toggle" type="checkbox" checked />
          <span class="slider"></span>
          <span class="label">Offline</span>
        </label>
      </div>
    </header>

    <main>
      <div id="panel-analyze" class="panel active" role="tabpanel" aria-labelledby="tab-analyze">
        <section class="card">
          <h2 style="margin-top:0">Analyze Tracks</h2>
          <form id="upload-form">
            <input id="file-input" type="file" multiple accept="audio/*" />
            <label class="toggle" style="margin-left:.5rem">
              <input id="enrich-toggle" type="checkbox" />
              <span class="slider"></span>
              <span class="label">Enrich</span>
            </label>
            <label class="toggle" style="margin-left:.5rem">
              <input id="generate-toggle" type="checkbox" />
              <span class="slider"></span>
              <span class="label">Generate</span>
            </label>
            <button id="analyze-btn" type="submit">Analyze</button>
          </form>
          <div id="results" style="margin-top:1rem"></div>
        </section>
      </div>
      <div id="panel-explore" class="panel" role="tabpanel" aria-labelledby="tab-explore">
        <section class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:1rem">
            <h2 style="margin:0">Library</h2>
            <button id="reload-lib" style="border-color:var(--ma-muted);color:var(--ma-muted)">Reload</button>
          </div>
          <div id="grid" class="grid" style="margin-top:1rem"></div>
          <div id="pager" class="row" style="margin-top:.5rem"></div>
        </section>
      </div>
      <div id="panel-reports" class="panel" role="tabpanel" aria-labelledby="tab-reports">
        <section class="card">
          <h2 style="margin-top:0">Reports</h2>
          <div class="controls" style="margin-bottom:.5rem">
            <button id="export-json">Export JSON</button>
            <button id="export-csv" style="border-color:var(--ma-accent-cool);color:var(--ma-accent-cool)">Export CSV</button>
          </div>
          <div id="reports-list" class="grid"></div>
        </section>
      </div>
      <div id="panel-more" class="panel" role="tabpanel" aria-labelledby="tab-more">
        <section class="card">
          <h2 style="margin-top:0">More</h2>
          <div id="results-more" style="margin-top:1rem"></div>
          <div id="grid-more" class="grid" style="margin-top:1rem"></div>
          <div id="reports-more" class="grid" style="margin-top:1rem"></div>
        </section>
      </div>
    </main>

    <!-- Detail modal -->
    <div id="detail" class="detail">
      <div class="detail-inner">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem">
          <h3 id="detail-title" style="margin:0"></h3>
          <button id="detail-close">Close</button>
        </div>
        <div id="detail-meta" class="muted" style="margin-bottom:.75rem"></div>
        <div class="charts">
          <canvas id="chart-radar" width="420" height="320"></canvas>
          <canvas id="chart-chroma" width="420" height="320"></canvas>
        </div>
      </div>
    </div>

    <!-- Toast container -->
    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <script src="./app.js"></script>
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js').catch(() => {});
      }
      // Default to offline mode on first load
      try {
        const stored = localStorage.getItem('ma-offline');
        const offline = stored === null ? '1' : stored;
        const toggle = document.getElementById('offline-toggle');
        if (toggle) toggle.checked = offline === '1';
        toggle?.addEventListener('change', () => localStorage.setItem('ma-offline', toggle.checked ? '1' : '0'));
      } catch (e) {}
    </script>
  </body>
  </html>


